<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="./style.css" rel="stylesheet">
    <title>Web-Usability</title>
</head>

<body class="min-vw-100">
    <nav class="navbar navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="/docs/5.0/assets/brand/bootstrap-logo.svg" alt="" width="30" height="24"
                    class="d-inline-block align-text-top">
                International Institute of Information And Technology, Hyderabad
            </a>
            <div class="navbar-brand d-flex">
                <button class="btn me-2 btn-outline-success" type="submit">Search</button>
                <button class="btn me-2 btn-outline-success" type="submit">Search</button>
            </div>
        </div>
    </nav>
    <div class="modal fade project-register-form" role="dialog" style="height:80vh;top:80px">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <h4>Add a Project</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div> 
                <div class="modal-body">
                    <div id="registrationDiv">
                        <form id="project-form" request="project/">
                            <div class="form-group">
                                <label for="name">Project Name:</label>
                                <input type="text" class="form-control" id="name" placeholder="Enter your name"
                                    name="name"> 
                            </div>

                            <div class="form-group">
                                <label for="organisation">Organisation:</label>
                                <input type="text" class="form-control" id="organisation"
                                    placeholder="Enter organisation" name="organisation">
                            </div>

                            <div class="form-group">
                                <label for="URL">URL:</label>
                                <input type="text" class="form-control" id="URL" placeholder="Enter Url" name="URL">
                            </div>
                            <div class="form-group">
                                <label for="description">Description:</label>
                                <textarea name="description" class="form-control" id="description" rows="4" cols="50"
                                    placeholder="Brief Description"></textarea>
                                <!-- <textarea rows="4" cols="50" name="comment" form="usrform" placeholder="Brief Description">
                          </textarea> -->
                                <!-- <input type="description" class="form-control" id="description"  name="description"> -->
                            </div>

                            <hr>
                            <button type="submit" class="btn btn-primary me-2">Register</button>
                        </form>
                    </div>
                </div>
            </div>
        </div> 
    </div>
    <div class="modal fade calender-form" role="dialog" style="height:90vh;top:20px">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <h4>Add An Event</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div> 
                <div class="modal-body">
                    <div id="registrationEvent">
                        <form id="calender-form" request="calendar/add_event/">
                            <div class="form-group">
                                <label for="name">Summary:</label>
                                <input type="text" class="form-control" id="name" placeholder="Enter your name"
                                    name="name"> 
                            </div>
                            <div class="form-group">
                                <label for="description">Description:</label>
                                <textarea name="description" class="form-control" id="description" rows="4" cols="50"
                                    placeholder="Brief Description"></textarea>
                                <!-- <textarea rows="4" cols="50" name="comment" form="usrform" placeholder="Brief Description">
                                </textarea> -->
                                <!-- <input type="description" class="form-control" id="description"  name="description"> -->
                            </div>    
                            <div class="form-group">
                                <label for="start">Start:</label>
                                <input type="datetime-local" class="form-control" id="start" placeholder="Time" name="start">
                              </div>

                              <div class="form-group">
                                <label for="end">End:</label>
                                <input type="datetime-local" class="form-control" id="end" placeholder="Time" name="end">
                              </div>
                            <hr>
                            <button type="submit" class="btn btn-primary me-2">Register</button>
                        </form>
                    </div>
                </div>
            </div>
        </div> 
    </div>
    <div id="contentPanel" class="row">
        <div class="col-9  justify-content-between">
            <h3>Dashboard</h3>
        </div>
        <hr>
        <div class="row align-items-start">
            <div class="row justify-content-between">
                <div class="col-3">
                    <h4 class="projectItem">Projects:</h4>
                </div>
                <div id="adminMode" class="col-2"><button id="addProject"
                        class="projectItem d-flex btn me-5 btn-success" type="submit" data-bs-toggle="modal"
                        data-bs-target=".project-register-form">+ Project</button></div>

            </div>
            <div class="row justify-content-start">


                <div id="projectList" class="row col-12">

                </div>
            </div>
        </div>
        <hr>
        <div class="row align-items-start">
            <div class="row justify-content-between">
                <div class="col-3">
                    <h4>Calender:</h4>
                </div>
                <div class="col-1">
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target=".calender-form">Add</button>
                </div>
            </div>
            <div class="row">
                <div id="calenderToday" class="box col-3">
                    <iframe
                        src="https://calendar.google.com/calendar/embed?height=600&wkst=1&bgcolor=%23ffffff&ctz=Asia%2FKolkata&showPrint=0&showTz=0&showTabs=0&mode=AGENDA&src=bWkybWwyb240bmc1MWEwNG4xa200c2l1MDhAZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ&src=Nm50aWZzZjdyb25wZWc2dWlqMmFkaDg5OG9AZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ&color=%237CB342&color=%23AD1457"
                        style="border:solid 1px #777; height:100%; width:100%" frameborder="0" scrolling="no"></iframe>
                </div>
                <div id="calender" class="box col-9">
                    <iframe
                        src="https://calendar.google.com/calendar/embed?height=600&wkst=1&bgcolor=%23ffffff&ctz=Asia%2FKolkata&showPrint=0&showTz=0&showTabs=0&src=bWkybWwyb240bmc1MWEwNG4xa200c2l1MDhAZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ&src=Nm50aWZzZjdyb25wZWc2dWlqMmFkaDg5OG9AZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ&color=%237CB342&color=%23AD1457"
                        style="border:solid 1px #777; height:100%; width:100%" frameborder="0" scrolling="no"></iframe>
                    
                </div>
            </div>
        </div>
    </div>
    </div>
    <footer id="footer">
        <div class="container-fluid">
            <div class="row-fluid" style="margin-top: 20px;font-size: 13px;">
                <div class="container">
                    <div class="copyright">Â© <span id="copyright-year">2021-2022</span> Software Engineering Research
                        Center
                        (SERC), IIIT-Hyderabad.</div>
                </div>
            </div>
        </div>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.slim.js"
        integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY=" crossorigin="anonymous"></script>
    <!-- CSS only -->
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <script> //$('.carousel').carousel(); 
        // var x = document.getElementById("addProject");

        var user_email = sessionStorage.getItem('user_email')
        var user_type = sessionStorage.getItem('user_type')
        var server_address = sessionStorage.getItem('server_address')
        var token = sessionStorage.getItem('token')
        var url = "";



        if (user_type == "participant/") {
            url = server_address + user_type;
        } else {
            url = server_address;
        }
        if (user_type != "observer/") {
            console.log("sda");
            $("#adminMode").hide();
        }



        async function postFormDataAsJson(url, formData) {
            const plainFormData = Object.fromEntries(formData.entries());
            const formDataJsonString = JSON.stringify(plainFormData);
            console.log(formDataJsonString);
            const fetchOptions = {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                    "Authorization": "token " + token
                },
                body: formDataJsonString,
            };
            console.log(url);
            const response = await fetch(url, fetchOptions);
            if (!response.ok) {
                const errorMessage = await response.text();
                throw new Error(errorMessage);
                if (confirm("Something Went Wrong!")) {
                    window.location.reload();
                } else {
                    window.location.reload();
                }
            } else {
                if (confirm("Project Added!")) {
                    window.location.reload();
                } else {
                    window.location.reload();;
                }
            }
            return response.json();
        }
        async function handleSubmit(event) {
            event.preventDefault();
            const form = event.currentTarget;
            request = form.getAttribute("request");
            const url_project = server_address + request;
            console.log(url_project);
            try {
                const formData = new FormData(form);
                const responseData = await postFormDataAsJson(url_project, formData);
                let responseObj = responseData;//= JSON.parse(responseData);
            } catch (error) {
                console.error(error);
            }
        }
        const projectForm = document.getElementById("project-form");
        projectForm.addEventListener("submit", handleSubmit);

        const calenderForm = document.getElementById("calender-form");
        calenderForm.addEventListener("submit", handleSubmit);
        // /////////////var data = JSON.stringify({"email": user_email});

        async function getProjects(url) {
            console.log(url);
            const fetchOptions = {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                    "Authorization": "token " + token
                }
            };
            try {
                let response = await fetch(url, fetchOptions);
                console.log(response);
                return await response.json();
            } catch (err) {
                console.error(err);
            }
        }   
        obj = "";
        responseData = "";
        let wraper = async function () {
            responseData = await getProjects(url + "project");
            console.log(responseData);

            // var responseData = '[{"id":"1","name":"Project 1"}, {"id":"2", "name":"Project 2"}, {"id":"3", "name":"Project 3"}, {"id":"4", "name":"Project 4"}]';
            obj = responseData;//= JSON.parse(responseData);
            // console.log(responseData);
            // console.log(obj);


            var tmp = '';
            var i = 0;
            $.each(obj, function (key, value) {
                tmp += '<a class="btn btn-outline-primary projectItem col-4" onClick="handleProjectSelect(' + (i++) + ')">';
                tmp += value.name
                tmp += '</a>';
            });
            $('#projectList').prepend(tmp);


        }
        wraper();

        function handleProjectSelect(id) {
            // console.log(id, obj[id]);
            sessionStorage.setItem('project_id', obj[id]._id);
            sessionStorage.setItem('project_name', obj[id].name);
            window.location.href = "projectdashboard.html";
        };
    </script>
</body>

</html>
